{% extends 'galeri/admin/base.html' %}
{% load static %}
{% load humanize %}
{% load l10n %}

{% block title %}KapsamlÄ± Raporlar - YÃ¶netici Paneli{% endblock %}

{% block extra_head %}
<style>
    .stat-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .chart-container {
        position: relative;
        height: 400px;
    }

    .tab-button {
        transition: all 0.3s;
    }

    .tab-button.active {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: #000;
        font-weight: bold;
    }

    .progress-bar {
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981, #059669);
        transition: width 0.5s ease;
    }

    .main-tab-button {
        border-bottom: 3px solid transparent;
        color: #6b7280;
        transition: all 0.3s;
    }

    .main-tab-button.active {
        border-bottom-color: #f59e0b;
        color: #000;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}

<!-- UI FonksiyonlarÄ± - Harici JS dosyasÄ± -->
<script src="{% static 'raporlar/js/raporlar-ui.js' %}"></script>

<div class="mb-8 flex justify-between items-center">
    <div>
        <h1 class="text-4xl font-bold text-gray-900 mb-2"> KapsamlÄ± SatÄ±ÅŸ RaporlarÄ±</h1>
        <p class="text-gray-600">DetaylÄ± analiz, karlÄ±lÄ±k ve performans metrikleri</p>
    </div>
    <div class="flex space-x-3">
        <a href="{% url 'raporlar:rapor_pdf' %}?baslangic_yil={{ baslangic_yil }}&bitis_yil={{ bitis_yil }}&baslangic_ay={{ baslangic_ay }}&bitis_ay={{ bitis_ay }}"
            class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center space-x-2">
            <i data-feather="file-text" class="w-5 h-5"></i>
            <span>PDF Ä°ndir</span>
        </a>
        <a href="{% url 'raporlar:rapor_excel' %}?baslangic_yil={{ baslangic_yil }}&bitis_yil={{ bitis_yil }}&baslangic_ay={{ baslangic_ay }}&bitis_ay={{ bitis_ay }}"
            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center space-x-2">
            <i data-feather="file" class="w-5 h-5"></i>
            <span>Excel Ä°ndir</span>
        </a>
    </div>
</div>
</div>



<!-- SERBEST RAPOR Ä°Ã‡ERÄ°ÄÄ° -->


<!-- Tarih Filtreleme -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-8">
    <h2 class="text-xl font-bold text-gray-900 mb-4">ğŸ“… Tarih AralÄ±ÄŸÄ± SeÃ§in</h2>

    <!-- HÄ±zlÄ± SeÃ§im ButonlarÄ± -->
    <div class="mb-6 flex flex-wrap gap-2">
        <button type="button" onclick="setQuickFilter('bu_ay')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            Bu Ay
        </button>
        <button type="button" onclick="setQuickFilter('gecen_ay')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            GeÃ§en Ay
        </button>
        <button type="button" onclick="setQuickFilter('bu_yil')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            Bu YÄ±l
        </button>
        <button type="button" onclick="setQuickFilter('gecen_yil')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            GeÃ§en YÄ±l
        </button>
        <button type="button" onclick="setQuickFilter('son_3_ay')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            Son 3 Ay
        </button>
        <button type="button" onclick="setQuickFilter('son_6_ay')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            Son 6 Ay
        </button>
        <button type="button" onclick="setQuickFilter('tumu')"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
            TÃ¼mÃ¼
        </button>
    </div>

    <form method="GET" action="{% url 'raporlar:raporlar' %}" id="tarihFiltreForm" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- BaÅŸlangÄ±Ã§ Tarihi -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-4">BaÅŸlangÄ±Ã§ Tarihi</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label for="baslangic_yil" class="block text-sm font-medium text-gray-700 mb-2">YÄ±l</label>
                        <select id="baslangic_yil" name="baslangic_yil"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent outline-none">
                            {% for yil in yil_listesi %}
                            <option value="{{ yil }}" {% if yil == baslangic_yil %}selected{% endif %}>{{ yil }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="baslangic_ay" class="block text-sm font-medium text-gray-700 mb-2">Ay</label>
                        <select id="baslangic_ay" name="baslangic_ay"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent outline-none">
                            <option value="0" {% if baslangic_ay == 0 %}selected{% endif %}>TÃ¼mÃ¼</option>
                            <option value="1" {% if baslangic_ay == 1 %}selected{% endif %}>Ocak</option>
                            <option value="2" {% if baslangic_ay == 2 %}selected{% endif %}>Åubat</option>
                            <option value="3" {% if baslangic_ay == 3 %}selected{% endif %}>Mart</option>
                            <option value="4" {% if baslangic_ay == 4 %}selected{% endif %}>Nisan</option>
                            <option value="5" {% if baslangic_ay == 5 %}selected{% endif %}>MayÄ±s</option>
                            <option value="6" {% if baslangic_ay == 6 %}selected{% endif %}>Haziran</option>
                            <option value="7" {% if baslangic_ay == 7 %}selected{% endif %}>Temmuz</option>
                            <option value="8" {% if baslangic_ay == 8 %}selected{% endif %}>AÄŸustos</option>
                            <option value="9" {% if baslangic_ay == 9 %}selected{% endif %}>EylÃ¼l</option>
                            <option value="10" {% if baslangic_ay == 10 %}selected{% endif %}>Ekim</option>
                            <option value="11" {% if baslangic_ay == 11 %}selected{% endif %}>KasÄ±m</option>
                            <option value="12" {% if baslangic_ay == 12 %}selected{% endif %}>AralÄ±k</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- BitiÅŸ Tarihi -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-4">BitiÅŸ Tarihi</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label for="bitis_yil" class="block text-sm font-medium text-gray-700 mb-2">YÄ±l</label>
                        <select id="bitis_yil" name="bitis_yil"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent outline-none">
                            {% for yil in yil_listesi %}
                            <option value="{{ yil }}" {% if yil == bitis_yil %}selected{% endif %}>{{ yil }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="bitis_ay" class="block text-sm font-medium text-gray-700 mb-2">Ay</label>
                        <select id="bitis_ay" name="bitis_ay"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent outline-none">
                            <option value="0" {% if bitis_ay == 0 %}selected{% endif %}>TÃ¼mÃ¼</option>
                            <option value="1" {% if bitis_ay == 1 %}selected{% endif %}>Ocak</option>
                            <option value="2" {% if bitis_ay == 2 %}selected{% endif %}>Åubat</option>
                            <option value="3" {% if bitis_ay == 3 %}selected{% endif %}>Mart</option>
                            <option value="4" {% if bitis_ay == 4 %}selected{% endif %}>Nisan</option>
                            <option value="5" {% if bitis_ay == 5 %}selected{% endif %}>MayÄ±s</option>
                            <option value="6" {% if bitis_ay == 6 %}selected{% endif %}>Haziran</option>
                            <option value="7" {% if bitis_ay == 7 %}selected{% endif %}>Temmuz</option>
                            <option value="8" {% if bitis_ay == 8 %}selected{% endif %}>AÄŸustos</option>
                            <option value="9" {% if bitis_ay == 9 %}selected{% endif %}>EylÃ¼l</option>
                            <option value="10" {% if bitis_ay == 10 %}selected{% endif %}>Ekim</option>
                            <option value="11" {% if bitis_ay == 11 %}selected{% endif %}>KasÄ±m</option>
                            <option value="12" {% if bitis_ay == 12 %}selected{% endif %}>AralÄ±k</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-end space-x-3">
            <button type="button" onclick="resetFilter()"
                class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">
                SÄ±fÄ±rla
            </button>
            <button type="submit"
                class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-6 rounded-lg transition-colors flex items-center space-x-2">
                <i data-feather="filter" class="w-5 h-5"></i>
                <span>Filtrele</span>
            </button>
        </div>
    </form>
</div>

<!-- Ã–zet Ä°statistikler -->


<!-- Tab Navigasyonu -->
<div class="bg-white rounded-xl shadow-lg p-2 mb-8">
    <div class="flex space-x-2 overflow-x-auto">
        <button onclick="showTab('genel')" class="tab-button active px-6 py-3 rounded-lg whitespace-nowrap"
            data-tab="genel">
            ğŸ“Š Genel BakÄ±ÅŸ
        </button>
        <button onclick="showTab('karlilik')" class="tab-button px-6 py-3 rounded-lg whitespace-nowrap"
            data-tab="karlilik">
            ğŸ’° KarlÄ±lÄ±k Analizi
        </button>
        <button onclick="showTab('performans')" class="tab-button px-6 py-3 rounded-lg whitespace-nowrap"
            data-tab="performans">
            âš¡ Performans
        </button>
        <button onclick="showTab('envanter')" class="tab-button px-6 py-3 rounded-lg whitespace-nowrap"
            data-tab="envanter">
            ğŸ“¦ Envanter
        </button>
        <button onclick="showTab('marka')" class="tab-button px-6 py-3 rounded-lg whitespace-nowrap" data-tab="marka">
            ğŸ·ï¸ Marka Analizi
        </button>
    </div>
</div>

<!-- GENEL BAKIÅ TAB -->
<div id="tab-genel" class="tab-content">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="stat-card bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
                    <i data-feather="truck" class="w-6 h-6"></i>
                </div>
            </div>
            <h3 class="text-3xl font-bold mb-1">{{ toplam_satilan }}</h3>
            <p class="text-yellow-100 text-sm">Toplam SatÄ±lan AraÃ§</p>
        </div>

        <div class="stat-card bg-gradient-to-br from-green-400 to-green-500 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
                    <i data-feather="dollar-sign" class="w-6 h-6"></i>
                </div>
            </div>
            <h3 class="text-3xl font-bold mb-1">{{ toplam_gelir|intcomma }} â‚º</h3>
            <p class="text-green-100 text-sm">Toplam Gelir</p>
        </div>

        <div class="stat-card bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
                    <i data-feather="trending-up" class="w-6 h-6"></i>
                </div>
            </div>
            <h3 class="text-3xl font-bold mb-1">{{ toplam_kar|intcomma }} â‚º</h3>
            <p class="text-blue-100 text-sm">Toplam Kar</p>
        </div>

        <div class="stat-card bg-gradient-to-br from-purple-400 to-purple-500 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
                    <i data-feather="package" class="w-6 h-6"></i>
                </div>
            </div>
            <h3 class="text-3xl font-bold mb-1">{{ mevcut_stok }}</h3>
            <p class="text-purple-100 text-sm">Mevcut Stok</p>
        </div>
    </div>

    <!-- Ortalama Metrikler -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-indigo-500">
            <div class="flex items-center space-x-3 mb-2">
                <i data-feather="bar-chart-2" class="w-5 h-5 text-indigo-500"></i>
                <h3 class="text-lg font-semibold text-gray-900">Ortalama SatÄ±ÅŸ FiyatÄ±</h3>
            </div>
            <p class="text-2xl font-bold text-gray-900">{{ ortalama_satis_fiyati|floatformat:0|intcomma }} â‚º</p>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-emerald-500">
            <div class="flex items-center space-x-3 mb-2">
                <i data-feather="pie-chart" class="w-5 h-5 text-emerald-500"></i>
                <h3 class="text-lg font-semibold text-gray-900">Ortalama Kar</h3>
            </div>
            <p class="text-2xl font-bold text-gray-900">{{ ortalama_kar|floatformat:0|intcomma }} â‚º</p>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <div class="flex items-center space-x-3 mb-2">
                <i data-feather="clock" class="w-5 h-5 text-orange-500"></i>
                <h3 class="text-lg font-semibold text-gray-900">Ortalama SatÄ±ÅŸ SÃ¼resi</h3>
            </div>
            <p class="text-2xl font-bold text-gray-900">
                {% if ortalama_satis_suresi %}
                {{ ortalama_satis_suresi|floatformat:0 }} gÃ¼n
                {% else %}
                -
                {% endif %}
            </p>
        </div>
    </div>
    <!-- AylÄ±k SatÄ±ÅŸlar ve Kar GrafiÄŸi (Kombine) -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ“ˆ AylÄ±k SatÄ±ÅŸlar ve Kar Analizi</h2>
        {% if aylik_satislar %}
        <div class="chart-container">
            <canvas id="aylikSatisKarChart"></canvas>
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500">
            <p class="text-lg">HenÃ¼z satÄ±ÅŸ verisi bulunmamaktadÄ±r.</p>
        </div>
        {% endif %}
    </div>

    <!-- Personel Performans GrafiÄŸi -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ‘¥ Personel PerformansÄ±</h2>
        {% if personel_performans %}
        <div class="chart-container">
            <canvas id="personelPerformansChart"></canvas>
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500">
            <p class="text-lg">HenÃ¼z personel performans verisi bulunmamaktadÄ±r.</p>
        </div>
        {% endif %}\
    </div>

    <!-- Marka BazÄ±nda Kar MarjÄ± YÃ¼zdesi -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ“Š Marka BazÄ±nda Kar MarjÄ± YÃ¼zdesi</h2>
        {% if marka_kar_marji %}
        <div class="chart-container">
            <canvas id="markaKarMarjiChart"></canvas>
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500">
            <p class="text-lg">HenÃ¼z kar marjÄ± verisi bulunmamaktadÄ±r.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- KARLILIK ANALÄ°ZÄ° TAB -->
<div id="tab-karlilik" class="tab-content hidden">
    <!-- Marka BazÄ±nda KarlÄ±lÄ±k -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ† Marka BazÄ±nda KarlÄ±lÄ±k</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-green-500 to-emerald-500 text-white">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Marka</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">SatÄ±ÅŸ SayÄ±sÄ±</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Toplam Kar</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Ortalama Kar</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">KarlÄ±lÄ±k</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for item in marka_karlilik %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ item.marka }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.satis_sayisi }} adet
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">
                            {{ item.toplam_kar|default:0|intcomma }} â‚º
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ item.ortalama_kar|default:0|floatformat:0|intcomma }} â‚º
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ item.kar_yuzdesi|default:0 }}%"></div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-600">
                            KarlÄ±lÄ±k verisi bulunmamaktadÄ±r.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- En KarlÄ± AraÃ§lar -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸŒŸ En KarlÄ± AraÃ§lar (Top 10)</h2>
            <div class="space-y-3">
                {% for arac in en_karli_araclar %}
                <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                    <div>
                        <p class="font-semibold text-gray-900"> {{ arac.model }}</p>
                        <p class="text-sm text-gray-600">{{ arac.yil }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-green-600">+{{ arac.kar_zarar|intcomma }} â‚º</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-gray-600 py-8">Veri bulunmamaktadÄ±r.</p>
                {% endfor %}
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6">âš ï¸ En Az KarlÄ± AraÃ§lar (Bottom 10)</h2>
            <div class="space-y-3">
                {% for arac in en_az_karli_araclar %}
                <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200">
                    <div>
                        <p class="font-semibold text-gray-900"> {{ arac.model }}</p>
                        <p class="text-sm text-gray-600">{{ arac.yil }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-red-600">{{ arac.kar_zarar|intcomma }} â‚º</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-gray-600 py-8">Veri bulunmamaktadÄ±r.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Fiyat Ä°ndirimi Analizi -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ·ï¸ Fiyat Ä°ndirimi Analizi</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                <p class="text-sm text-gray-600 mb-2">Ä°ndirimli SatÄ±ÅŸ SayÄ±sÄ±</p>
                <p class="text-3xl font-bold text-blue-600">{{ fiyat_indirimi_sayisi }}</p>
            </div>
            <div class="p-6 bg-purple-50 rounded-lg border border-purple-200">
                <p class="text-sm text-gray-600 mb-2">Toplam Ä°ndirim TutarÄ±</p>
                <p class="text-3xl font-bold text-purple-600">{{ toplam_fiyat_indirimi|intcomma }} â‚º</p>
            </div>
            <div class="p-6 bg-pink-50 rounded-lg border border-pink-200">
                <p class="text-sm text-gray-600 mb-2">Ortalama Ä°ndirim</p>
                <p class="text-3xl font-bold text-pink-600">{{ ortalama_fiyat_indirimi|floatformat:0|intcomma }} â‚º
                </p>
            </div>
        </div>
    </div>
</div>

<!-- PERFORMANS TAB -->
<div id="tab-performans" class="tab-content hidden">
    <!-- En HÄ±zlÄ± SatÄ±lan AraÃ§lar -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸš€ En HÄ±zlÄ± SatÄ±lan AraÃ§lar</h2>
            <div class="space-y-3">
                {% for item in en_hizli_satilan %}
                <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                    <div>
                        <p class="font-semibold text-gray-900"> {{ item.arac.model }}</p>
                        <p class="text-sm text-gray-600">{{ item.arac.yil }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-green-600">{{ item.sure }} gÃ¼n</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-gray-600 py-8">Veri bulunmamaktadÄ±r.</p>
                {% endfor %}
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸŒ En YavaÅŸ SatÄ±lan AraÃ§lar</h2>
            <div class="space-y-3">
                {% for item in en_yavas_satilan %}
                <div class="flex items-center justify-between p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <div>
                        <p class="font-semibold text-gray-900"> {{ item.arac.model }}</p>
                        <p class="text-sm text-gray-600">{{ item.arac.yil }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-orange-600">{{ item.sure }} gÃ¼n</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-gray-600 py-8">Veri bulunmamaktadÄ±r.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Durum BazÄ±nda Performans -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ“Š Durum BazÄ±nda SatÄ±ÅŸ PerformansÄ±</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Durum</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">SatÄ±ÅŸ SayÄ±sÄ±</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Toplam Gelir</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Toplam Kar</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for item in durum_performans %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            {% if item.durum == 'yeni' %}
                            <span
                                class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold">Yeni</span>
                            {% else %}
                            <span
                                class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-semibold">FÄ±rsat</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.satis_sayisi }} adet
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">
                            {{ item.toplam_gelir|intcomma }} â‚º
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">
                            {{ item.toplam_kar|default:0|intcomma }} â‚º
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="px-6 py-8 text-center text-gray-600">
                            Veri bulunmamaktadÄ±r.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ENVANTER TAB -->
<div id="tab-envanter" class="tab-content hidden">
    <!-- Stokta Kalanlar -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ“¦ Stokta Kalan AraÃ§lar (Ä°lk 20)</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-purple-500 to-pink-500 text-white">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">AraÃ§</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">YÄ±l</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Ä°lan FiyatÄ±</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Stokta Kalma SÃ¼resi</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Durum</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for item in stokta_kalanlar %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                             {{ item.arac.model }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.arac.yil }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.arac.ilan_fiyat|intcomma }} â‚º</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-orange-600">{{ item.sure }}
                            gÃ¼n</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            {% if item.arac.durum == 'yeni' %}
                            <span
                                class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold">Yeni</span>
                            {% else %}
                            <span
                                class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-semibold">FÄ±rsat</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-600">
                            Stokta araÃ§ bulunmamaktadÄ±r.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- YÄ±l BazÄ±nda DaÄŸÄ±lÄ±m -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸš— SatÄ±lan AraÃ§larÄ±n YÄ±l BazÄ±nda DaÄŸÄ±lÄ±mÄ±</h2>
        {% if yil_dagilimi %}
        <div class="chart-container">
            <canvas id="yilDagilimiChart"></canvas>
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500">
            <p class="text-lg">HenÃ¼z yÄ±l bazÄ±nda veri bulunmamaktadÄ±r.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- MARKA ANALÄ°ZÄ° TAB -->
<div id="tab-marka" class="tab-content hidden">
    <!-- Markalara GÃ¶re SatÄ±ÅŸlar GrafiÄŸi -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ·ï¸ Markalara GÃ¶re SatÄ±ÅŸlar</h2>
        {% if marka_toplam_satis %}
        <div class="chart-container">
            <canvas id="markaSatislarChart"></canvas>
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500">
            <p class="text-lg">HenÃ¼z marka bazÄ±nda veri bulunmamaktadÄ±r.</p>
        </div>
        {% endif %}
    </div>

    <!-- Markalara GÃ¶re DetaylÄ± Tablo -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">ğŸ“‹ Markalara GÃ¶re DetaylÄ± SatÄ±ÅŸlar</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-yellow-400 to-orange-400 text-gray-900">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Marka</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">SatÄ±lan AraÃ§ SayÄ±sÄ±</th>
                        <th class="px-6 py-4 text-left text-sm font-bold uppercase">Toplam Gelir</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for item in marka_toplam_satis %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ item.marka }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.toplam }} adet</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                            {% for gelir in marka_toplam_gelir %}
                            {% if gelir.marka == item.marka %}
                            {{ gelir.toplam_gelir|intcomma }} â‚º
                            {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="px-6 py-8 text-center text-gray-600">
                            HenÃ¼z satÄ±ÅŸ kaydÄ± bulunmamaktadÄ±r.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>










<!-- Grafik Verileri - Django'dan JavaScript'e JSON Transfer -->
<script id="chart-data" type="application/json">
{
    "aylikSatislar": {% if aylik_satislar %}{
        "labels": [{% for ay, sayi in aylik_satislar.items %}"{{ ay }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "data": [{% for ay, sayi in aylik_satislar.items %}{{ sayi|default:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}]
    }{% else %}null{% endif %},
    "aylikGelir": {% if aylik_gelir %}{
        "labels": [{% for ay, gelir in aylik_gelir.items %}"{{ ay }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "data": [{% for ay, gelir in aylik_gelir.items %}{{ gelir|default:0|unlocalize }}{% if not forloop.last %}, {% endif %}{% endfor %}] }{% else %}null{% endif %},
    "aylikKar": {% if aylik_kar %}{
        "labels": [{% for ay, kar in aylik_kar.items %}"{{ ay }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "data": [{% for ay, kar in aylik_kar.items %}{{ kar|default:0|unlocalize }}{% if not forloop.last %}, {% endif %}{% endfor %}]
    }{% else %}null{% endif %},
    "markaKarMarji": {% if marka_kar_marji %}{
        "labels": [{% for item in marka_kar_marji %}"{{ item.marka }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "data": [{% for item in marka_kar_marji %}{{ item.kar_marji_yuzdesi|default:0|unlocalize }}{% if not forloop.last %}, {% endif %}{% endfor %}]
    }{% else %}null{% endif %},
    "markaSatislar": {% if marka_toplam_satis %}{
        "labels": [{% for item in marka_toplam_satis %}"{{ item.marka }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "data": [{% for item in marka_toplam_satis %}{{ item.toplam|default:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}]
    }{% else %}null{% endif %},
    "yilDagilimi": {% if yil_dagilimi %}{
        "labels": [{% for item in yil_dagilimi %}"{{ item.yil }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "data": [{% for item in yil_dagilimi %}{{ item.satis_sayisi|default:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}]
    }{% else %}null{% endif %},
    "personelPerformans": {% if personel_performans %}{
        "labels": [{% for item in personel_performans %}"{{ item.personel }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "satisAdedi": [{% for item in personel_performans %}{{ item.satis_adedi|default:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}],
        "toplamKar": [{% for item in personel_performans %}{{ item.toplam_kar|default:0|unlocalize }}{% if not forloop.last %}, {% endif %}{% endfor %}]
    }{% else %}null{% endif %}
}
</script>

<!-- Chart.js KÃ¼tÃ¼phanesi -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<!-- Grafik FonksiyonlarÄ± - Harici JS dosyasÄ± -->
<script src="{% static 'raporlar/js/raporlar-charts.js' %}"></script>

<!-- Grafikleri BaÅŸlat -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log('ğŸš€ Chart initialization starting...');

        // Chart.js yÃ¼klÃ¼ mÃ¼ kontrol et
        if (typeof Chart === 'undefined') {
            console.error('âŒ Chart.js kÃ¼tÃ¼phanesi yÃ¼klenmedi!');
            return;
        }
        console.log('âœ… Chart.js yÃ¼klendi:', Chart.version);

        // Feather icons
        if (typeof feather !== 'undefined') {
            feather.replace();
            console.log('âœ… Feather icons yÃ¼klendi');
        }

        // JSON verisini parse et
        var chartDataElement = document.getElementById('chart-data');
        if (!chartDataElement) {
            console.error('âŒ chart-data elementi bulunamadÄ±!');
            return;
        }

        try {
            var chartData = JSON.parse(chartDataElement.textContent);
            console.log('âœ… Chart data parse edildi:', chartData);

            // Canvas elementlerini kontrol et
            var canvases = {
                'aylikSatisKarChart': document.getElementById('aylikSatisKarChart'),
                'personelPerformansChart': document.getElementById('personelPerformansChart'),
                'markaKarMarjiChart': document.getElementById('markaKarMarjiChart'),
                'markaSatislarChart': document.getElementById('markaSatislarChart'),
                'yilDagilimiChart': document.getElementById('yilDagilimiChart')
            };

            console.log('ğŸ“Š Canvas elementleri:', canvases);

            // TÃ¼m grafikleri baÅŸlat
            if (typeof initAllCharts === 'function') {
                console.log('ğŸ¨ initAllCharts fonksiyonu Ã§aÄŸrÄ±lÄ±yor...');
                initAllCharts(chartData);
                console.log('âœ… Grafikler baÅŸlatÄ±ldÄ±');
            } else {
                console.error('âŒ initAllCharts fonksiyonu bulunamadÄ±!');
            }
        } catch (error) {
            console.error('âŒ Chart initialization hatasÄ±:', error);
            console.error('Stack trace:', error.stack);
        }
    });
</script>
{% endblock %}